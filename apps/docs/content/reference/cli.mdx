# CLI Reference

All commands are deterministic. Validation uses embedded schemas.

---

## Quick Reference

| Command     | Purpose                               | Modifies State |
| ----------- | ------------------------------------- | -------------- |
| `explore`   | Search codebase, symbols, call graphs | No             |
| `store`     | Store idea/decision/learning          | Yes            |
| `recall`    | Search and retrieve knowledge         | No             |
| `brief`     | Get file briefing and intelligence    | No             |
| `init`      | Initialize .palace/ structure         | Yes            |
| `scan`      | Build/refresh Index                   | Yes            |
| `check`     | Verify freshness and CI               | No             |
| `serve`     | Start MCP server                      | No             |
| `session`   | Manage agent sessions                 | Yes            |
| `corridor`  | Cross-workspace sharing               | Varies         |
| `dashboard` | Start web dashboard                   | No             |
| `clean`     | Cleanup stale data                    | Yes            |
| `update`    | Self-update to latest                 | Yes            |
| `version`   | Show version info                     | No             |

---

## Core Commands

### explore

Search the codebase, symbols, and call graphs.

```sh
palace explore "<query>" [options]
palace explore --map <symbol> [options]
```

**Options**:
| Flag | Description |
|------|-------------|
| `--room <name>` | Filter to specific room |
| `--limit <n>` | Maximum results (default: 10) |
| `--fuzzy` | Enable fuzzy matching |
| `--full` | Get full context (generates `context-pack.json`) |
| `--map <symbol>` | Trace call graph for a symbol or file |
| `--depth <n>` | Recursion depth for call chain (1-10) |
| `--direction <d>` | Trace direction: `up`, `down`, or `both` |

---

### store

Store ideas, decisions, and learnings (auto-classified).

```sh
palace store "<content>" [options]
```

**Options**:
| Flag | Description |
|------|-------------|
| `--as <type>` | Force type: `decision`, `idea`, `learning` |
| `--scope <scope>` | Scope: `file`, `room`, `palace` (default: `palace`) |
| `--path <path>` | Scope path for file/room scope |

---

### recall

Search and retrieve knowledge.

```sh
palace recall [query] [options]
```

**Options**:
| Flag | Description |
|------|-------------|
| `--type <type>` | Filter by type: `decision`, `idea`, `learning` |
| `--pending` | Show decisions awaiting outcome |

**Subcommands**:

- `update <id> <outcome>`: Record decision outcome (`success`, `failed`, `mixed`)
- `link <src> --<rel> <tgt>`: Create relationships between records

---

### brief

Get file briefing and intelligence.

```sh
palace brief <file-path> [options]
```

**Options**:
| Flag | Description |
|------|-------------|
| `--sessions` | Include recent agent activity details |

---

## Setup & Indexing

### init

Initialize the palace in the current directory.

```sh
palace init [options]
```

**Options**:
| Flag | Description |
|------|-------------|
| `--detect` | Auto-detect project type and generate rooms |
| `--with-outputs` | Also create generated output templates |
| `--force` | Overwrite existing curated files |

---

### scan

Build or refresh the Index (Tier-0).

```sh
palace scan
```

Parses files using Tree-sitter and stores symbols in SQLite.

---

### check

Verify Index freshness and validate schemas.

```sh
palace check [options]
```

**Options**:
| Flag | Description |
|------|-------------|
| `--strict` | Hash all files (slower but thorough) |
| `--diff <range>` | Scope check to a specific git diff range |
| `--collect` | Also generate context pack from diff |
| `--signal` | Also generate change signal from diff |

---

## Maintenance

### clean

Cleanup stale sessions, agents, and old learnings.

```sh
palace clean [--dry-run]
```
