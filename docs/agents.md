---
layout: default
title: Agents
nav_order: 6
---

# Agent Integration

Mind Palace treats AI agents as first-class consumers. Schemas are contracts, not suggestions.

---

## Two Integration Modes

| Mode | Best For | How |
|------|----------|-----|
| **MCP** | Interactive agents (Claude, Cursor) | `palace serve` |
| **Context Pack** | Batch/CLI agents | `palace collect` |

---

## MCP Integration

### Setup (Claude Desktop)

Add to `~/Library/Application Support/Claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "mind-palace": {
      "command": "palace",
      "args": ["serve", "--root", "/path/to/project"]
    }
  }
}
```

### Setup (Cursor)

```json
{
  "mcp.servers": {
    "mind-palace": {
      "command": "palace",
      "args": ["serve", "--root", "${workspaceFolder}"]
    }
  }
}
```

### Available Tools

| Tool | Parameters | Returns |
|------|------------|---------|
| `search_mind_palace` | `query`, `limit?`, `room?` | Ranked results by Room |
| `list_rooms` | - | Room names + entry points |

### Available Resources

| URI | Returns |
|-----|---------|
| `palace://files/{path}` | File content |
| `palace://rooms/{name}` | Room manifest JSON |

### Why MCP?

- **Targeted queries** - Search, don't dump
- **Room-aware** - Results grouped by Room
- **Entry point boosting** - Important files surface first
- **Live index** - No stale context packs

---

## Context Pack Integration

For agents that can't use MCP:

```sh
palace collect --goal "Fix auth bug"
# Provide .palace/outputs/context-pack.json to agent
```

The context pack contains:
- Goal and scope
- Referenced files with content
- Room context
- Provenance (scan ID, timestamp)

---

## Agent Rules

### Must Read

| File | Contains |
|------|----------|
| `palace.jsonc` | Project config, guardrails |
| `rooms/*.jsonc` | Entry points, scope |
| `context-pack.json` | Current goal, findings |

### Must Not Touch

| Path | Reason |
|------|--------|
| `.palace/index/*` | Generated by CLI |
| `.palace/outputs/*` | Generated by CLI |
| Files matching guardrails | Protected |

### Scope Discipline

```
If scope is "diff":
  Only modify files in the diff
  Request broader scope explicitly if needed

If scope is "full":
  Still respect guardrails
  Prefer Room-scoped changes
```

---

## Verification Loop

```
Agent proposes → Human reviews → Save → Observer verifies → Fresh ✓ or Stale ✗
```

### With Observer (VS Code)

1. Agent queries via MCP or reads context pack
2. Agent proposes changes
3. Human saves files
4. Observer runs `palace verify`
5. HUD shows Fresh (green) or Stale (red)
6. If stale, auto-heal runs `scan && collect`

### Without Observer (CLI)

```sh
# After agent changes
palace verify --fast
# If stale:
palace scan && palace collect
```

---

## Handling Staleness

When `palace verify` fails:

```
Agent: "Index is stale. Please run `palace scan && palace collect` or approve auto-heal."
```

Never proceed with stale context. Request refresh.

---

## Change Signal

For diff-scoped work:

```sh
palace signal --diff HEAD~1..HEAD
palace collect --diff HEAD~1..HEAD
```

Agents should:
1. Check if `change-signal.json` exists
2. Use its file list to scope work
3. Treat deleted files as non-editable
