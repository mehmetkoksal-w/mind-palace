# Mind Palace Alignment Assessment

**Date:** 2026-01-12
**Assessed by:** Claude Opus 4.5
**Codebase Version:** 0.3.0-alpha (commit 497dbe4)

---

## 1. Fact-Based Inventory

### Canonical Artifacts That Exist

| Artifact | Storage | Source of Truth? | Agent-Writable? |
|----------|---------|------------------|-----------------|
| **Decisions** | `memory.db:decisions` | Partial (has status/outcome) | Yes, directly via `store` |
| **Learnings** | `memory.db:learnings` | Partial (confidence-weighted) | Yes, directly via `store` |
| **Rooms** | `.palace/rooms/*.jsonc` | Yes (human-authored) | No (read-only) |
| **Guardrails** | `.palace/palace.jsonc` | Yes | No |
| **Project Profile** | `.palace/project-profile.json` | Yes (generated by scan) | Yes (auto-generated) |
| **Postmortems** | `memory.db:postmortems` | Partial (failure memory) | Yes, directly via MCP |

### Process Artifacts That Exist

| Artifact | Storage | Purpose |
|----------|---------|---------|
| **Sessions** | `memory.db:sessions` | Track agent work spans |
| **Activities** | `memory.db:activities` | Log actions within sessions |
| **Ideas** | `memory.db:ideas` | Exploratory thoughts (not committed) |
| **ContextPack** | `.palace/outputs/context-pack.json` | Snapshot for handoff |
| **Conversations** | `memory.db:conversations` | Agent conversation archives |
| **Links** | `memory.db:links` | Relationships between records |

### Agent Protocols (Implicitly Enforced)

1. **Session lifecycle**: Agents *should* call `session_start`, `session_log`, `session_end` - but not enforced (`apps/cli/internal/butler/mcp_tools_session.go:12-122`)
2. **Conflict detection**: Agents can check via `session_conflict` - voluntary, not blocking (`mcp_tools_session.go:393-427`)
3. **Guardrails respected**: File access patterns in `config.go:218-278` - enforced at scan level, not write level
4. **Scope inheritance**: `file → room → palace → corridor` (`config.go:139-154`) - enforced in queries

### Governance Mechanisms in Code

| Mechanism | File | Enforcement Level |
|-----------|------|-------------------|
| Guardrails (doNotTouch) | `config.go:17-19` | Scan-time only |
| Learning confidence | `learning.go:153-175` | Query ordering |
| Decision outcome feedback | `decision.go:233-271` | Manual recording |
| Contradiction detection | `mcp_tools_brain.go:687-769` | Optional, LLM-powered |
| Learning decay | `learning.go:273-294` | Optional, time-based |
| Learning-decision links | `learning.go:381-464` | Feedback loop exists |

### Where System Already Behaves Like Single Source of Truth

1. **Rooms** (`.palace/rooms/*.jsonc`): Schema-validated, human-authored, read-only to agents
2. **Guardrails**: Defined in `palace.jsonc`, consulted during scans
3. **Project Profile**: Auto-generated but represents detected capabilities
4. **Decision outcome tracking**: Creates feedback loop, outcomes affect linked learnings

---

## 2. Gap Analysis Relative to Vision

### Gap 1: No Explicit Canonical vs Non-Canonical Distinction

**What is missing:**
- All knowledge (decisions, learnings, ideas) stored in same SQLite tables with same access patterns
- No `is_approved` or `status: draft|approved|authoritative` field on decisions/learnings
- Ideas auto-classified as decisions immediately become "truth"

**Gap type:** Structural (data model) + Semantic (authority unclear)

**Impact:**
- Agents cannot distinguish "this is approved truth" from "this is a working hypothesis"
- Context windows cannot be reduced because agents must read everything to find truth
- Safe delegation impossible - no clear line between "read this" and "verify this first"

**Evidence:** `memory/decision.go:10-25` - Decision has `Status` field but only tracks `active|superseded|reversed`, not `draft|approved`

### Gap 2: Agents Can Mutate Truth Directly

**What is missing:**
- The `store` MCP tool writes directly to decisions table without approval gate
- No `propose` vs `commit` separation in API
- Auto-classification can create decisions from natural language without human review

**Gap type:** Enforcement-related

**Impact:**
- Agents are not governed - they are autonomous
- Human cannot step away safely - agent might create authoritative-looking decisions
- Predictability compromised - truth can change without human awareness

**Evidence:** `mcp_tools_brain.go:12-157` - `toolStore` creates decisions directly via `s.butler.AddDecision(dec)`

### Gap 3: Missing Policy/Constraint/Default Records

**What is missing:**
- Vision mentions "constraints, defaults, policies, system structure"
- Current data model only has: decisions, learnings, ideas, postmortems
- No schema for: policies, constraints, configuration defaults, architectural invariants

**Gap type:** Structural (data model incomplete)

**Impact:**
- Cannot express "always do X" or "never do Y" as queryable truth
- Agents cannot look up policies without parsing prose in decisions
- System structure not machine-readable

### Gap 4: Second-Brain Layer Not Cleanly Separated

**What is missing:**
- LLM integration (`llm/` package) is used for contradiction detection and extraction
- LLM outputs can directly create links (`ContradictionAutoLink`)
- No explicit boundary preventing LLM-generated content from becoming authoritative

**Gap type:** Lifecycle-related (promotion boundary missing)

**Impact:**
- Cognitive layer can silently influence truth (via auto-linking)
- Synthesized insights not marked as "needs human review"
- Cannot safely enable LLM-powered features without risking governance

**Evidence:** `mcp_tools_brain.go:115-148` - Auto-contradiction links created without approval when `ContradictionAutoLink` enabled

### Gap 5: Process and State Mixed in Storage

**What is missing:**
- Sessions (process) and Decisions (state) both in `memory.db`
- No clear separation in schema or queries
- Agents cannot ask "what is currently true" vs "what happened"

**Gap type:** Semantic + Discoverability

**Impact:**
- Query surface conflates process with truth
- Context injection (`auto_injection`) mixes session artifacts with decisions
- Reduced context windows cannot be achieved without separating concerns

---

## 3. Process vs State Classification

### Current Artifacts: State (Truth Agents Should Rely On)

| Artifact | Actually State? | Notes |
|----------|-----------------|-------|
| Decisions | **Partial** | Has outcome tracking, but no draft→approved |
| Learnings | **Partial** | Confidence-weighted, but can be created by agents |
| Postmortems | **Yes** (when resolved) | Failure memory with lessons |
| Rooms | **Yes** | Human-authored, read-only |
| Guardrails | **Yes** | Configures boundaries |

### Current Artifacts: Process (Logs, Summaries, Plans)

| Artifact | Actually Process? | Notes |
|----------|-------------------|-------|
| Sessions | **Yes** | Agent work spans |
| Activities | **Yes** | Action logs |
| Ideas | **Partial** | Should be process, but stored same as state |
| Conversations | **Yes** | Archives |
| ContextPack | **Yes** | Snapshot for handoff |

### Where Process Is Being Treated As State

1. **Ideas** (`idea.go`): Stored with same API surface as decisions. `toolRecallIdeas` returns them alongside decisions in briefings. Ideas should be proposals, not queryable truth.

2. **Auto-extracted content** (`config.go:75`): `AutoExtract` setting allows LLM to extract decisions from sessions - these become state without approval.

3. **Learning confidence** as proxy for approval: High confidence treated as "more true" (`learning.go:243-271`), but this is emergent, not explicit.

### Where State Is Implicit Instead of Explicit

1. **Policies embedded in decisions**: No first-class Policy type. Decisions like "We use JWT for auth" become policy by convention.

2. **Architectural constraints**: No schema for expressing "X depends on Y" or "never use Z" as queryable facts.

3. **Defaults**: No mechanism to store "default behavior for agents in this room" as structured data.

### Missing Promotion Boundaries

- **Idea → Decision**: No explicit promotion. Ideas can be marked `implemented` but not converted.
- **Draft → Approved**: Does not exist. Decisions created as `status: active` immediately.
- **Agent-generated → Human-approved**: No boundary. Agent can write decisions via `store`.
- **LLM-synthesized → Canonical**: Auto-linking creates authoritative relationships without review.

---

## 4. Second-Brain Readiness Assessment

### Current LLM Integration Points

| Feature | Location | Governance |
|---------|----------|------------|
| Contradiction detection | `mcp_tools_brain.go:687-845` | Optional, requires config |
| Auto-linking contradictions | `mcp_tools_brain.go:115-148` | Configurable threshold |
| Conversation extraction | `conversation.go` (referenced) | `autoExtract` config |
| Embedding generation | `embedding.go` + pipeline | Background, non-blocking |

### What Would Need to Exist for Clean Cognitive Layer

1. **Proposal record type**: LLM outputs should create `Proposal` records, not `Decision` records directly. Schema needed.

2. **Approval workflow**: Human must explicitly promote `Proposal → Decision`. API needed.

3. **Provenance tracking for LLM content**: Records need `generatedBy: llm` vs `createdBy: human` distinction. Partially exists via `source` field but not enforced.

4. **Read-only mode for LLM**: Cognitive layer should only have `read` + `propose` permissions, not `write` to canonical tables. Requires API segmentation.

5. **Synthesis output buffer**: LLM summaries should go to a non-authoritative location (e.g., `suggestions/` or `proposals/` table) before promotion.

### Current Risks If Cognitive Layer Enabled Fully

- `ContradictionAutoLink` can create authoritative links without human review
- `AutoExtract` can create decisions from conversation summaries
- `store` tool with auto-classification can misclassify ideas as decisions
- No audit log of "this was LLM-generated" separate from "this was agent-logged"

---

## 5. Alignment Scorecard

| Vision Pillar | Status | Evidence |
|---------------|--------|----------|
| **Single Source of Truth** | **Partially Aligned** | Has decisions/learnings but no draft→approved, no policies schema |
| **Explicit, Inspectable, Machine-Readable** | **Aligned** | JSON schemas, SQLite, JSONC configs |
| **Agents Read from Mind Palace** | **Aligned** | MCP tools provide read access |
| **Agents Write Plans/Logs/Summaries** | **Partially Aligned** | Sessions/activities work, but also write to truth |
| **Governed, Not Autonomous** | **Missing** | No approval gate, agents write directly |
| **Coordination via Artifacts** | **Partially Aligned** | Sessions/conflicts exist but not enforced |
| **Predictability over Autonomy** | **Missing** | Agents can mutate state freely |
| **Safe to Step Away** | **Missing** | No approval workflow, LLM can auto-modify |
| **Second Brain Doesn't Silently Influence Truth** | **Missing** | Auto-linking, auto-extract bypass approval |
| **Reduced Context Windows** | **Partially Aligned** | Scoped queries exist, but process/state mixed |

---

## 6. Top 5 Structural Changes Needed

### 1. Add `authority` Field to Decisions and Learnings

**What:** Add `authority: draft | proposed | approved | canonical` to decisions and learnings schemas.

**Why:** Enables agents to distinguish "read this as truth" from "this needs review." Essential for:
- Reduced context windows (query only `authority: approved+`)
- Safe delegation (agents only consume approved state)
- Human stepping away (can review pending proposals async)

**Files affected:** `memory/decision.go`, `memory/learning.go`, `memory/schema.go`

### 2. Create `Proposal` Record Type with Promotion Workflow

**What:** New table `proposals` with fields for: content, proposed_as (decision|learning|policy), proposed_by (agent|llm|human), reviewed_by, promoted_to_id.

**Why:** Separates LLM/agent output from canonical truth. All auto-extracted content, auto-classified decisions, and LLM suggestions go here first. Human explicitly promotes via CLI/dashboard.

**Files affected:** New `memory/proposal.go`, modify `mcp_tools_brain.go` to write proposals not decisions

### 3. Segment MCP API into Read-Only vs Propose vs Admin

**What:**
- Read-only tools: `recall`, `brief`, `explore_*` (current behavior, unchanged)
- Propose tools: `propose_decision`, `propose_learning`, `store` (writes to proposals table)
- Admin tools: `approve`, `reject`, `promote` (human-only, not exposed to agents)

**Why:** Governance by API design. Agents cannot bypass approval because they don't have the tools. LLM cognitive layer uses same propose tools.

**Files affected:** `butler/mcp.go`, `butler/mcp_tools_brain.go`, new CLI commands

### 4. Add `Policy` and `Constraint` Record Types

**What:** New schema for policies (always/never rules) and constraints (X depends on Y, X must not use Z).

**Why:** Vision requires "constraints, defaults, policies" as explicit truth. Currently these are prose inside decisions. Machine-readable policies enable:
- Automatic policy checking before agent actions
- Queryable system structure
- Reduced context (agent queries specific policy, not all decisions)

**Files affected:** New `memory/policy.go`, `memory/constraint.go`, modify schema

### 5. Separate Process Database from State Database

**What:**
- `memory.db` → sessions, activities, conversations, proposals (process)
- `truth.db` → decisions, learnings, policies, constraints, postmortems (state)

**Why:** Physical separation makes the distinction unambiguous. Agents can be given read access to `truth.db` and read-write to `memory.db`. Queries against truth don't need to filter out process artifacts.

**Files affected:** `memory/memory.go`, `butler/butler.go`, migration required

---

## 7. Things That Are Correct and Should Not Be Changed

1. **Room manifests** (`.palace/rooms/*.jsonc`): Schema-validated, human-authored, read-only to agents. This is the right pattern for declarative truth.

2. **Scope hierarchy** (file → room → palace → corridor): Well-designed knowledge boundaries. Queries respect scope inheritance correctly.

3. **Decision outcome tracking** (`decision.go:233-271`): Feedback loop where outcomes affect linked learnings' confidence. This is governance working.

4. **Learning confidence decay** (`learning.go:273-294`): Time-based freshness ensures stale knowledge loses authority. Correct design.

5. **Guardrails** (`config.go:17-19`, `defaultGuardrails()`): File access constraints are explicit and respected at scan time.

6. **MCP protocol implementation** (`mcp.go`): Clean JSON-RPC, proper tool dispatch, good foundation for adding governance.

7. **Link relations** (`link.go:31-37`): `supports`, `contradicts`, `supersedes`, `implements` - expressive relationship types for knowledge graph.

8. **Provenance tracking** (`model.go:96-104`): Records have `createdBy`, `createdAt`, `generator`. Foundation for attribution exists.

9. **Schema versioning** (`schema.go:11-31`): Migration system works. Can evolve schema safely.

10. **SQLite + WAL mode** (`memory.go:84-93`): Appropriate for local-first, supports concurrent access.

---

## 8. One-Sentence Diagnosis

**Mind Palace is currently closest to a local knowledge base with agent session tracking, but needs explicit approval workflows and process/state separation to become a governance substrate where humans can safely delegate to AI agents.**

---

## Summary

The codebase has solid foundations (schema validation, scoped queries, outcome tracking, MCP protocol) but conflates process artifacts with authoritative state, allows agents to write truth directly, and lacks explicit promotion boundaries that would enable governed autonomy. The five structural changes above would close the gap to the vision without requiring wholesale redesign.
